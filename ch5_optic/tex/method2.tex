\section{\nn{} Runtime Energy Adaptation} \label{sec:method2}

\nn{} runtime energy adaptation utilises the presented runtime energy profiling to dynamically adapts the voltage threshold to the latest energy consumption of a task. 
This method assumes the system is able to monitor the supply voltage and signal the MCU to wake up or sleep when a high or low threshold is hit, and the threshold is configurable by the MCU at runtime. 
The voltage monitoring ability is widely required by prior IPSs in the forms of a voltage comparator~\cite{kang2018homerun, balsamo2016hibernus++}, an energy management unit~\cite{gomez2016dynamic, maeng2019supporting}, or a periodic ADC polling~\cite{sliper2019efficient}. 

\nn{} runtime energy adaptation is decoupled with the method of energy profiling. 
The adaptation scheme requires an interface of the energy profiling method that can return a profiling result and trigger an instance of profiling.


% Outline
% goal
% basic adaptation for constant operation
%   flowchart
% optional linear adaptation
% optional multiple configurations (can be similar to multiple atom_func_state)





Support three types of adaptation.

With a target end voltage $\symb{V}{end}$ below which the system fails, the voltage threshold $\symb{V}{th}$ that the system should set to ensure a task's completion is
\begin{equation}
    \symb{V}{th} = \symb{V}{end} + \Delta \symb{V}{task}
\end{equation}

\subsection{Profiling Strategy}

When should we take a profiling measurement?

Goal: Reduce unnecessary/redundant measurements and take necessary measurements.

\subsection{Learning Algorithm}

How do we use the measurements to update the voltage threshold?

Enable voltage threshold adaptation against runtime variation of energy consumption due to unforeseeable operating conditions, and also enable linear adaptation to function knobs that are known to the system. 

\begin{itemize}
    \item Without function knobs: use the latest profiled threshold.
    \item With function knobs: do a linear regression based on a number of recent measurements. 
\end{itemize}

\subsection{Discussion}

The ability to fall back differentiates it from a "simply-incrementing-threshold" DEBS.
